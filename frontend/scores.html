<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Classement ‚Äì Cyber Detective</title>
  <style>
    body { 
      font-family:'Courier New', monospace; 
      background: linear-gradient(135deg,#0f0f23,#1a1a3a);
      color:#00ff41;
      display:flex;flex-direction:column;
      align-items:center;padding:20px;
      cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="%2368FF64" stroke="%2315CC0F" stroke-width="0.75" d="M5.5 3.21V20.8c0 .45.54.67.85.35l4.86-4.86a.5.5 0 0 1 .35-.15h6.87a.5.5 0 0 0 .35-.85L6.35 2.85a.5.5 0 0 0-.85.35Z"></path></svg>'), auto ;
    }
    h1 { text-shadow:0 0 10px #00ff41; margin-bottom:20px; }
    table { border-collapse:collapse; width:100%; max-width:600px; }
    th, td { border:1px solid #00ff41; padding:8px; text-align:center; }
    th { background:rgba(0,255,65,0.2); }
  </style>
</head>
<body>
  <h1>üèÜ Classement des √©quipes</h1>
  <table>
    <thead>
  <tr>
    <th>Rang</th><th>√âquipe</th><th>Temps (s)</th><th>Date</th><th>Vitesse</th>
  </tr>
</thead>
    <tbody id="scoresBody">
      <tr><td colspan="5">Chargement‚Ä¶</td></tr>
    </tbody>
  </table>
<script src="config.js"></script>
<script>
(function () {
  const API = `${API_BASE_URL}/api/scores`; // adapte si besoin
  const tbody = document.getElementById('scoresBody');
  if (!tbody) {
    console.error("Pas de <tbody id='scoresBody'> sur la page.");
    return;
  }

  const setOneRow = (text) => {
    tbody.innerHTML = `<tr><td colspan="5" style="text-align:center">${text}</td></tr>`;
  };

  const formatDuration = (sec) => {
    const m = Math.floor(sec / 60);
    const s = sec % 60;
    return `00:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  };

  const badgeIcon = (b) => b === 'or' ? 'ü•á' : b === 'argent' ? 'ü•à' : b === 'bronze' ? 'ü•â' : '';

  const formatDate = (row) => {
    // 1) cas recommand√©: created_at est un ISO string ou timestamp
    if (row.created_at) {
      const d = new Date(row.created_at);
      if (!isNaN(d)) {
        return d.toLocaleDateString('fr-FR') + ' ' +
               d.toLocaleTimeString('fr-FR', {hour:'2-digit',minute:'2-digit'});
      }
    }
    // 2) fallback si le backend renvoie deux champs
    if (row.created_date && row.created_time) {
      return `${row.created_date} ${row.created_time}`;
    }
    // 3) dernier recours: on √©vite "Invalid Date"
    return '‚Äî';
  };

  async function loadScores() {
    try {
      const res = await fetch(API, { headers: { 'Accept': 'application/json' } });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const rows = await res.json();
      if (!Array.isArray(rows)) throw new Error('Payload non conforme');

      if (rows.length === 0) {
        setOneRow('Aucun score pour le moment.');
        return;
      }

      tbody.innerHTML = '';
      rows.forEach((row, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${i + 1}</td>
          <td>${row.team_name}</td>
          <td>${formatDuration(row.duration_seconds)}</td>
          <td>${formatDate(row)}</td>
          <td>${badgeIcon(row.badge)}</td>
        `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error('[scores] √âchec de chargement:', err);
      setOneRow('‚ö†Ô∏è Erreur de chargement (ouvre la console pour les d√©tails).');
    }
  }

  // Lance le chargement (attendre que le DOM soit pr√™t si le script n‚Äôest pas "defer")
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadScores);
  } else {
    loadScores();
  }
})();
</script>

</body>
</html>
