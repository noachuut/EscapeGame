<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cyber Detective ‚Äì Accueil</title>
  <link rel="icon" href="assets/logo.png" type="image/png">
  <script src="config.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Courier New', monospace;
      background: linear-gradient(135deg,#0f0f23,#1a1a3a);
      color:#00ff41;
      height:100vh;
      overflow:hidden;
      cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path fill="%2368FF64" stroke="%2315CC0F" stroke-width="0.75" d="M5.5 3.21V20.8c0 .45.54.67.85.35l4.86-4.86a.5.5 0 0 1 .35-.15h6.87a.5.5 0 0 0 .35-.85L6.35 2.85a.5.5 0 0 0-.85.35Z"></path></svg>'), auto ;
    }
    .matrix-bg {
      position:fixed; top:0; left:0;
      width:100%; height:100%;
      pointer-events:none; opacity:0.1; z-index:-1;
    }
    .welcome {
      position:absolute;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      background:rgba(0,255,65,0.05);
      border:2px solid #00ff41;
      border-radius:10px;
      padding:40px;
      text-align:center;
      width:80%; max-width:600px;
      box-shadow:0 0 20px rgba(0,255,65,0.3);
    }
    .welcome h1 {
      font-size:2em; margin-bottom:20px;
      text-shadow:0 0 10px #00ff41;
    }
    .input-group { margin-bottom:20px; text-align:center; margin-top: 20px;}
    .input-group label { display:block; margin-bottom:5px; }
    .input-group input {
      width:100%; padding:10px;
      background:rgba(0,0,0,0.5);
      border:2px solid #00ff41;
      border-radius:5px;
      color:#00ff41;
    }
    .btn-start {
      background:linear-gradient(45deg,#00ff41,#00cc33);
      color:#000; border:none;
      padding:12px 20px; border-radius:5px;
      cursor:pointer; font-size:1em;
      transition:all 0.3s ease;
      position:relative; overflow:hidden;
    }
    .btn-start:hover {
      transform:scale(1.05);
      box-shadow:0 5px 15px rgba(0,255,65,0.4);
    }
    .btn-start:active { transform:scale(0.95); }

    /* Ripple effect */
    .ripple {
      position:absolute; border-radius:50%;
      background:rgba(255,255,255,0.4);
      transform:scale(0); pointer-events:none;
      animation:ripple 0.6s linear;
    }
    @keyframes ripple { to { transform:scale(4); opacity:0; } }

    /* Fade overlay */
    .fade-overlay {
      position:fixed; inset:0; background:#000;
      opacity:0; pointer-events:none;
      transition:opacity 0.6s; z-index:3000;
    }
    .fade-overlay.active { opacity:1; }

    /* Intro overlay full-screen */
#intro-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 15, 35, 0.95);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  /* animation: introFade 6s ease-in-out forwards; */ /* retir√© */
}


/* Logo et message */
#intro-logo {
  width: 150px;
  filter: drop-shadow(0 0 10px #00ff41);
  margin-bottom: 20px;
  border-radius: 50%;      /* ‚Üê rend l‚Äôimage circulaire */
  object-fit: cover;  
}
#intro-text {
  color: #1fdb0e;
  font-family: 'Courier New', monospace;
  font-size: 1.2rem;
  text-align: center;
  text-shadow: 0 0 8px #00ff41;
  line-height: 1.4;
  max-width: 600px;
  animation: textPulse 2s infinite alternate 1s;
}

/* Animation de disparition */
@keyframes introFade {
  0%   { opacity: 0; }
  20%  { opacity: 1; }
  80%  { opacity: 1; }
 100%  { opacity: 0; visibility: hidden; }
}

/* L√©g√®re pulsation du texte */
@keyframes textPulse {
  from { text-shadow: 0 0 8px #00ff41; }
  to   { text-shadow: 0 0 16px #00ff41, 0 0 24px #00ff41; }
}

  </style>
</head>
<body>
  <canvas class="matrix-bg" id="matrix"></canvas>
  <div id="fadeOverlay" class="fade-overlay"></div>

  <div id="intro-overlay">
  <img src="assets/logo.png" alt="Logo Cyber Detective" id="intro-logo">
  <p id="intro-text">¬´ Yo Bienvenue dans l'Escape Game Cyber Detective,<br>
  imagin√© par les BTS SIO. Thomas a besoin de vous : soyez rapides ! ¬ª</p>
  </div>

  <div class="welcome">
    <h1>üïµÔ∏è CYBER DETECTIVE üïµÔ∏è</h1>
    <p>Bienvenue enqu√™teurs !</p>
    <div class="input-group">
      <label for="teamName">Nom de votre √©quipe :</label>
      <input type="text" id="teamName" placeholder="Ex : Kitamort">
    </div>
    <button class="btn-start" onclick="startGame()">D√©marrer la mission</button>
  </div>

  <script>
    const intro = document.getElementById('intro-overlay');

    intro.addEventListener('click', () => {
      intro.remove();
      document.querySelector('.welcome').classList.add('visible');
    });


    async function startGame() {
      const name = document.getElementById('teamName').value.trim();
      if (!name) {
        alert("Veuillez entrer un nom d'√©quipe.");
        return;
      }


      try {
        const res = await fetch(`${API_BASE_URL}/api/check-team?team=${encodeURIComponent(name)}`);
        if (!res.ok) throw new Error(`Erreur r√©seau (${res.status})`);
        const { exists } = await res.json();

        if (exists) {
          alert("Ce nom d'√©quipe est d√©j√† pris. Choisissez-en un autre.");
          return;
        }

        // Stocke le nom en localStorage pour la page de jeu
      localStorage.setItem('cyberTeam', name);
      // Transition vers la page du jeu
      fadeTo('game.html');
      }

      catch (err) {
      console.error("startGame ‚Ä∫", err);
      alert("Impossible de v√©rifier le nom d'√©quipe. R√©essayez plus tard.");
    }
      
    }
    function initMatrix() {
            const canvas = document.getElementById('matrix');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const chars = '01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≥';
            const charArray = chars.split('');
            const fontSize = 14;
            const columns = canvas.width / fontSize;
            const drops = Array.from({ length: columns }).map(() => 1);
            function draw() {
                ctx.fillStyle = 'rgba(15, 15, 35, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#00ff41';
                ctx.font = fontSize + 'px monospace';
                drops.forEach((y, i) => {
                    const text = charArray[Math.floor(Math.random() * charArray.length)];
                    ctx.fillText(text, i * fontSize, y * fontSize);
                    if (y * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                    drops[i]++;
                });
            }
            setInterval(draw, 50);
        }
    
    function attachRipples() {
      document.querySelectorAll('button, .btn-start').forEach(btn => {
        btn.addEventListener('click', e => {
          const circle = document.createElement('span');
          circle.className = 'ripple';
          const rect = btn.getBoundingClientRect();
          const size = Math.max(rect.width, rect.height);
          circle.style.width = circle.style.height = size + 'px';
          circle.style.left = (e.clientX - rect.left - size/2) + 'px';
          circle.style.top  = (e.clientY - rect.top  - size/2) + 'px';
          btn.appendChild(circle);
          setTimeout(() => circle.remove(), 600);
        });
      });
    }

    function fadeTo(url) {
      const ov = document.getElementById('fadeOverlay');
      ov.classList.add('active');
      setTimeout(() => { window.location.href = url; }, 600);
    }

    window.onload = () => { initMatrix(); attachRipples(); };
  </script>
</body>
</html>
